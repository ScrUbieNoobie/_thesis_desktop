<div class="main-header bg_3 flex">
    <div class="header-txt">
        <p class="tg_ln_v3 fnt_clr_1">Change credentials</p>
        <p class="tg_ln fnt_clr_2">You may create a new passcode for
            <br>your account.</p>
    </div>
    <img class="header-img" src="../assets/images/profile.png">
</div>
<div class="user-form">
    <form id="edit-form-creds">
        <input class="acc_id" value="" name="acc_id" hidden readonly>
        <div class="flex_v2 edit-box">
            <label class="fnt_clr_2 tg_ln">
                Enter Old Passcode
            </label>
            <div class="spacer_v2"></div>
            <div class="input-holder_v2">
                <input type="password" class="edit_pass" name="old" value="" required>
            </div>
        </div>
        <div class="flex_v2 edit-box">
            <label class="fnt_clr_2 tg_ln">
               Enter New Passcode
            </label>
            <div class="spacer_v2"></div>
            <div class="input-holder_v2">
                <input type="password" id="new" class="edit_pass" name="new" value="" required>
            </div>
        </div>
        <div class="flex_v2 edit-box">
            <label class="fnt_clr_2 tg_ln">
                Confirm New Passcode
            </label>
            <div class="spacer_v2"></div>
            <div class="input-holder_v2">
                <input type="password" id="confirm" class="edit_pass" name="confirm" value="" required>
            </div>
        </div>
        <button id="edit_btn_pass" type="submit" class="hover_shdw btn_1 full fnt_clr_3 bg_9">
            Save changes
        </button>
    </form>
</div>
<script>
    $(document).ready(function(){

        $('.acc_id').attr('value', sessionStorage.getItem('acc_id'));

        var edit_stats = 0;

        $('.edit_pass').on('keydown', function(){
            edit_stats = 1;
            $('#edit_btn_pass').html('Save changes');
            
        })

        $('#edit-form-creds').submit(function(e){
            e.preventDefault()
            var data = $(this).serialize();
            if(edit_stats == 1){
                if($('#new').val() == $('#confirm').val()){
                    $('#edit_btn_pass').addClass('unclickable');
                $('#edit_btn_pass').removeClass('hover_shdw');
                $('#edit_btn_pass').html('Processing Request &nbsp;&nbsp;<i class="fas fa-wrench"></i>');
                    $.ajax({
                        method: 'POST',
                        data: data,
                        dataType: 'JSON',
                        url: 'http://localhost/cimo_desktop/app/edit_creds.php',
                        success: function(resp){
                            if(resp.status == 'Success'){
                                setTimeout(function(){
                                    $('#edit_btn_pass').removeClass('unclickable');
                                    $('#edit_btn_pass').addClass('hover_shdw');
                                    $('#edit_btn_pass').html('Request successful &nbsp;&nbsp;<i class="fas fa-thumbs-up"></i>');
                                    edit_stats  = 0;
                                    console.log(resp)
                                }, 2000)
                            }else{
                                setTimeout(function(){
                                    edit_stats  = 0;
                                    $('#edit_btn_pass').removeClass('unclickable');
                                    $('#edit_btn_pass').addClass('hover_shdw');
                                    $('#edit_btn_pass').html('Request error &nbsp;&nbsp;<i class="fas fa-thumbs-up"></i>');
                                }, 2000)
                            }
                        }
                    })
                }else{
                    edit_stats  = 0;
                    $('#edit_btn_pass').html('Password does not match &nbsp;&nbsp;<i class="fas fa-question"></i>');
                }
            }else{
                $('#edit_btn_pass').html('Nothing to save &nbsp;&nbsp;<i class="fas fa-question"></i>');
            }
        })

    })
</script>